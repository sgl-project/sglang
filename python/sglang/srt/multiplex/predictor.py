import torch

H800_PREFILL_PARAMETERS_SEQLEN_LT_2K={8: [129.55309586358206, 14.202295424960557, 43.18436528786068, 268.8128454352999], 16: [71.58716385124262, 7.2049047145678315, 23.86238795041422, 144.6677710855961], 24: [47.75054152991417, 4.983768070227911, 15.916847176638067, 119.43536790581618], 32: [40.4077721603157, 3.715647143856666, 13.469257386771906, 97.32466928841825], 40: [33.38530722514602, 3.2345956642770166, 11.128435741715347, 88.63855726035055], 48: [26.640754113825707, 2.7673503966620703, 8.88025137127524, 87.14961973210009], 56: [25.652189920114896, 2.3602159502731324, 8.550729973371638, 81.34230746779323], 64: [26.81867402098899, 1.9396660826927032, 8.939558006996334, 65.9653316862514], 72: [23.038216820058892, 1.9184118637036267, 7.679405606686302, 65.38159395065105], 80: [19.881980010705405, 1.914711514075925, 6.627326670235138, 68.44974701041076], 88: [19.01577299879501, 1.5260632995922072, 6.338590999598341, 71.39406176500536], 96: [17.650568198788054, 1.5265783946154288, 5.883522732929356, 71.90448120890967], 104: [18.892198747442663, 1.5354274831511812, 6.297399582480892, 63.64465941199953], 112: [17.714636769405626, 1.5374006422697777, 5.904878923135211, 64.66167485683145], 120: [18.071952485298926, 1.548922222822811, 6.02398416176631, 62.5772032934873], 128: [20.906144909156392, 1.0140620806529224, 6.968714969718801, 47.79003699374124], 132: [17.449577926665317, 1.0090158173769412, 5.816525975555109, 48.09325591538291]}
H800_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K={8: [40.89798022833329, 14.041140454031826, 3.4081650190277752, 1001.6735732375869], 16: [21.651893365386325, 7.043488684061513, 1.8043244471155273, 551.2325872210349], 24: [15.40397343677621, 4.853061947222452, 1.2836644530646846, 406.07918770334686], 32: [12.35189974470528, 3.56604613732705, 1.0293249787254402, 327.6628674921219], 40: [9.668253427519252, 2.9347574476015104, 0.8056877856266044, 331.3321823260153], 48: [8.446522034224705, 2.5072988103200373, 0.7038768361853922, 282.5796808777968], 56: [8.196413934692858, 2.2502276214681385, 0.6830344945577382, 240.84006162638468], 64: [7.489436042401217, 1.797202796464201, 0.6241196702001016, 223.65922415287264], 72: [6.993447362914567, 1.7987116065897268, 0.5827872802428807, 208.48971852837258], 80: [5.912215127437647, 1.6295217561547866, 0.49268459395313735, 234.25585790918126], 88: [6.102563729422577, 1.3672106767755323, 0.5085469774518815, 204.61433062671927], 96: [5.935456663808284, 1.3858263427897033, 0.49462138865069044, 196.46917906149918], 104: [5.0327304975453035, 1.220719645841994, 0.4193942081287755, 225.49487954117342], 112: [4.940278319425362, 1.225734022182252, 0.4116898599521136, 216.8850947880311], 120: [4.696700373743664, 1.231240364497404, 0.39139169781197214, 220.8355659735368], 128: [5.416043360964305, 0.9339891777590874, 0.45133694674702546, 167.4661613020104], 132: [5.242472630648394, 0.9337617586151531, 0.43687271922069953, 160.06258038124213]}
H800_PREFILL_PARAMETERS_SEQLEN_GT_8K={8: [7.736577433470744, 15.070452509765346, 394.81116068983795, -271.8842491490359], 16: [3.913176172160355, 7.608907503661534, 205.97513157655396, -54.46829884141334], 24: [2.6332421444708065, 5.123833923065044, 147.58697031636913, -27.2121915110838], 32: [1.9686735662984434, 3.8356673262050283, 119.50355308090799, -11.550679913274507], 40: [1.5747964750472447, 3.076130319494938, 101.66431656828802, 23.74336631210099], 48: [1.3135161144567684, 2.565384687227464, 89.47168204280348, 35.93752737398245], 56: [1.1233844669711566, 2.2021404359093886, 81.46320757410703, 41.093776844165404], 64: [0.986667445459122, 1.9194274481443605, 75.24995763277091, 28.726175979334585], 72: [0.8857213693427254, 1.7129806040109132, 69.38490127808535, 75.95787843068683], 80: [0.7909886010454056, 1.5488454224474575, 70.32288513520874, -16.25773288584969], 88: [0.7302185629017147, 1.414776584387964, 66.53329974678016, 16.282720035977036], 96: [0.6699418648521077, 1.2990672887171004, 65.53832600608052, -4.37187706982877], 104: [0.6116060042150743, 1.198196792258159, 65.72934190457285, -46.13700531146969], 112: [0.5857294223971199, 1.124602853039975, 62.045548163162074, 22.595880649709216], 120: [0.5387554458134424, 1.051887612516175, 62.66883763822827, -15.007947992393383], 128: [0.5152077598245811, 0.9763896115645228, 61.495318856029385, -45.50288429966531], 132: [0.48988606049729333, 0.9653740347124011, 62.61534877144275, -84.84710322485898]}
H800_DECODE_PARAMETERS_SEQLEN_LT_128K={8: [0.002721732262186228, 0.32644095570250253, 42.70936860335967], 16: [0.0014298101495123722, 0.14693580353835278, 25.22721615351711], 24: [0.000931841519951885, 0.12588822213156692, 20.362467744023867], 32: [0.0006834430457291104, 0.10863190021164311, 17.787700584408768], 40: [0.0005701967298579474, 0.08829195106426896, 16.627920950016854], 48: [0.00046317006133785824, 0.08630357812486351, 16.109462248734374], 56: [0.0004064223866470799, 0.06424114161172885, 15.872349147989972], 64: [0.00037322587061215375, 0.05944065964232027, 15.127976613139351], 72: [0.0003259638486989871, 0.06089306991236651, 14.937524679848247], 80: [0.00029958160880263194, 0.052045846572436646, 14.724633254362407], 88: [0.0002720144597562183, 0.05225507461038098, 14.685420068524262], 96: [0.00022563246432706876, 0.05980876993607771, 14.76774387412346], 104: [0.0002133270336083719, 0.052662782273191565, 14.772965590429502], 112: [0.00019060527185443368, 0.05508599330843708, 14.81609351452868], 120: [0.0001866440479232935, 0.054612812951309334, 14.636130041763222], 128: [0.00017056799179214488, 0.06090823743763455, 14.235630021575815], 132: [0.00013641416400826214, 0.07224469536979726, 14.298108036866175]}
H800_DECODE_PARAMETERS_SEQLEN_GT_128K={8: [0.0005325716201871933, 0.22818913456452616, 102.42172764550625], 16: [0.00026746830535020924, 0.08120542794877736, 56.31975862818233], 24: [0.00018571005836201212, 0.09857569823702682, 39.90922380085621], 32: [0.0001352697699992356, 0.05778024299875904, 33.38649107319755], 40: [0.00011011906486037306, 0.061171815418994024, 29.114958428832953], 48: [9.257533117088884e-05, 0.028322239394453913, 27.049560751033372], 56: [7.969014426750231e-05, 0.031957550777617645, 25.159007341577265], 64: [7.007478425087707e-05, 0.026229867977408658, 23.872839235704237], 72: [6.24266056963973e-05, 0.05009970455445126, 21.944046804855745], 80: [5.769288647073122e-05, 0.04397850853774466, 21.23919225084108], 88: [5.520120428908455e-05, 0.054941633232745445, 20.169531262179326], 96: [5.022897854805739e-05, 0.044022325759411, 19.827775583028107], 104: [4.5234950428714796e-05, 0.030549836157490625, 19.750795207615937], 112: [4.224856810871005e-05, 0.010848266035880658, 20.091576083493134], 120: [4.0669060422645673e-05, 0.02824580515102876, 19.203205671101678], 128: [3.855522821427316e-05, 0.006209396181664271, 19.301857064541444], 132: [3.589187688842647e-05, 0.03879359414724748, 17.836719685413364]}

RTX3090_PREFILL_PARAMETERS_SEQLEN_LT_2K={8: [-3.9487936651267437, 11.482932741423838, 1066.5244835255864, -195.020421732037], 16: [4.225917851304643, 4.7227135335977835, 811.5623275273942, 2.477435931349646], 24: [3.2317393482697425, 3.2364149322475555, 775.0263877412565, -0.617570832059755], 32: [2.7126133368447127, 2.3615317498908155, 756.9272476055837, 0.6733075181209642], 40: [2.330990783533837, 1.969664464400978, 747.0690804352598, 1.0667385914603074], 48: [1.86539295062885, 1.6024492236444416, 742.2264214245223, 4.153892035677927], 56: [1.763143940909141, 1.4449725626298004, 736.9359082362479, 5.498968723735288], 64: [1.7859131835882012, 1.1826470867668206, 731.7117554972226, 7.947848573848205], 72: [1.726167279293945, 1.1728899110723603, 729.3541727299526, 5.093096534005326], 80: [1.5453084378359534, 1.0340903505249912, 728.0935875528509, 5.160462361215195]}
RTX3090_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K={8: [-3.9487936651267437, 11.482932741423838, 1066.5244835255864, -195.020421732037], 16: [4.225917851304643, 4.7227135335977835, 811.5623275273942, 2.477435931349646], 24: [3.2317393482697425, 3.2364149322475555, 775.0263877412565, -0.617570832059755], 32: [2.7126133368447127, 2.3615317498908155, 756.9272476055837, 0.6733075181209642], 40: [2.330990783533837, 1.969664464400978, 747.0690804352598, 1.0667385914603074], 48: [1.86539295062885, 1.6024492236444416, 742.2264214245223, 4.153892035677927], 56: [1.763143940909141, 1.4449725626298004, 736.9359082362479, 5.498968723735288], 64: [1.7859131835882012, 1.1826470867668206, 731.7117554972226, 7.947848573848205], 72: [1.726167279293945, 1.1728899110723603, 729.3541727299526, 5.093096534005326], 80: [1.5453084378359534, 1.0340903505249912, 728.0935875528509, 5.160462361215195]}
RTX3090_PREFILL_PARAMETERS_SEQLEN_GT_8K={8: [-3.9487936651267437, 11.482932741423838, 1066.5244835255864, -195.020421732037], 16: [4.225917851304643, 4.7227135335977835, 811.5623275273942, 2.477435931349646], 24: [3.2317393482697425, 3.2364149322475555, 775.0263877412565, -0.617570832059755], 32: [2.7126133368447127, 2.3615317498908155, 756.9272476055837, 0.6733075181209642], 40: [2.330990783533837, 1.969664464400978, 747.0690804352598, 1.0667385914603074], 48: [1.86539295062885, 1.6024492236444416, 742.2264214245223, 4.153892035677927], 56: [1.763143940909141, 1.4449725626298004, 736.9359082362479, 5.498968723735288], 64: [1.7859131835882012, 1.1826470867668206, 731.7117554972226, 7.947848573848205], 72: [1.726167279293945, 1.1728899110723603, 729.3541727299526, 5.093096534005326], 80: [1.5453084378359534, 1.0340903505249912, 728.0935875528509, 5.160462361215195]}
RTX3090_DECODE_PARAMETERS_SEQLEN_LT_64K={8: [0.11829556566213924, 0.8415169222641502, 21.430746329413083], 16: [0.052312096789742676, 0.8072572172714509, 14.171473525027896], 24: [0.0524651838111566, 0.7946443692426082, 11.802409738273283], 32: [0.05561440403670641, 0.7949921327616818, 10.9892124343059], 40: [0.057125098865281956, 0.7958813301362658, 10.803124625947419], 48: [0.05199308248796353, 0.7833481894276019, 9.656753740936747], 56: [0.05359981926982656, 0.7838049879409444, 9.696083770235155], 64: [0.05228882692651806, 0.7782586725382387, 9.359367468827108], 72: [0.05728133396338797, 0.7695907182736248, 9.446732284846128], 80: [0.05136959110597764, 0.7759831553525446, 9.339999276422793]}
RTX3090_DECODE_PARAMETERS_SEQLEN_GT_64K={8: [0.16275276474803319, 0.9146618437706682, 16.258389128988476], 16: [0.08238272436042379, 0.8695993729788153, 10.291782906793244], 24: [0.0899351851534906, 0.8567571746973066, 7.43592098473686], 32: [0.07997017598185527, 0.8475279696375836, 7.734015752225723], 40: [0.08408714080974625, 0.8394578198666232, 7.803996274254203], 48: [0.08747720495180346, 0.848611889618254, 5.175531621911048], 56: [0.08854674944396086, 0.8432182153224846, 5.519230069846657], 64: [0.07996792104616471, 0.8449344876085154, 5.52071429391863], 72: [0.08014064509584914, 0.8280005028070031, 6.170480993052415], 80: [0.08178164252625081, 0.8376296366195067, 5.551473108936484]}

A100_PREFILL_PARAMETERS_SEQLEN_LT_2K={8: [-49.98208959642849, 22.719417113280656, 1094.4734139591305, -0.4247418090546944], 16: [-26.163813774687295, 11.544293243785376, 566.1040774086961, 8.595257285812181], 24: [2.3523699415443438, 8.227209434914926, 323.44741870316864, 39.40085872488629], 32: [-28.33815454674068, 5.909864398570576, 320.71193321726173, 1.7626669869473517], 40: [-2.851562662673006, 5.359546434642965, 219.12402967572177, 31.541648195749417], 48: [6.702389950945923, 4.28074589240105, 166.3162927262142, 37.27135498132179], 56: [4.125235787333135, 4.15721232518759, 149.53340001654618, 32.186473364852844], 64: [-21.475524502437064, 3.137959210030097, 193.8194973677351, 5.7234912072828195], 72: [0.06628697360798459, 3.0456647298452246, 135.92087132792267, 31.1426861665727], 80: [-15.57731838538061, 3.0088398010956503, 158.68574312943153, 16.127375465126306], 88: [5.962880554145318, 2.993815825027422, 101.41382890738853, 35.45477571178961], 96: [21.15854393444605, 2.508618313333624, 59.090623795230655, 49.03969020392729], 104: [10.514584245119428, 2.491444876737839, 82.77256209066755, 35.85166696885281], 108: [10.044779130221531, 2.5086087193018614, 83.523471217873, 34.81767370333074]}
A100_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K={8: [13.528436676940634, 23.069722985923534, 910.1217227325479, 109.94635368112267], 16: [6.897041446200157, 11.605218526145748, 468.0702750728732, 58.93698765005456], 24: [5.515401626951112, 7.862806187922672, 308.439076520606, 42.12120200321738], 32: [3.7848866315343255, 5.867155248826741, 241.22172618110017, 29.052812140590277], 40: [2.3133050406997473, 4.85658205567367, 205.14183628242503, 22.07764501947031], 48: [2.8668262900619115, 4.066854400091955, 168.16631716239004, 32.30236032899688], 56: [3.5298781129383228, 3.6178228375700776, 134.46478751431403, 70.82307389633104], 64: [2.4611517462498647, 2.9995316523551665, 128.9919758099614, 43.74125090675739], 72: [2.4274748823351127, 2.946153714156903, 115.49154997296276, 60.43583760708805], 80: [3.098788253426344, 2.6452497832527087, 96.79797552870974, 78.8829301869248], 88: [1.4505708137748585, 2.386011551615468, 107.61050651178502, 35.385622091628875], 96: [3.089553921466292, 2.1726775103726457, 85.66055447156062, 58.7881712158719], 104: [3.0266628193495793, 2.0180434658121627, 79.01449473283643, 76.76927582103394], 108: [-0.12316125221987512, 2.0082241542683157, 106.83198975174791, 19.294851499186848]}
A100_PREFILL_PARAMETERS_SEQLEN_GT_8K={8: [12.53696376259125, 23.048497313039064, 919.4931104089206, 95.32483454045177], 16: [6.6612876431082375, 11.601526951967955, 468.9330308804773, 64.73334818979515], 24: [5.62150015476781, 7.8848860464769075, 305.64276201541696, 55.142114062557994], 32: [4.254234180185202, 5.869743074245697, 235.2024566205348, 46.97281588161911], 40: [2.9268476472553715, 4.887057586386227, 196.52667372022694, 49.60456952178379], 48: [2.932224940701064, 4.079814476422584, 166.00581435516725, 43.37876810987757], 56: [2.208177213392476, 3.6505054321697266, 148.38086083314687, 39.22934519518117], 64: [2.200032335622598, 3.0079192310024503, 131.3985413275131, 39.69528310844976], 72: [1.5552228701041766, 2.9521832684188993, 124.48508934813559, 41.54639850473541], 80: [1.759505575879413, 2.66728036676691, 111.29082771137622, 44.58456696677342], 88: [1.302886355953886, 2.42283952309041, 108.05466801567424, 38.096093624501634], 96: [2.0331034657555325, 2.193032777437921, 96.20533814871604, 37.81547455588634], 104: [1.339504844678797, 2.0467277222750155, 96.87588896378033, 36.34621068834002], 108: [0.01460641238257435, 2.038543369340804, 104.19171730033399, 29.36698125020166]}
A100_DECODE_PARAMETERS_SEQLEN_LT_128K={8: [0.5214967750165963, 0.2288688619479558, 74.70867850298023], 16: [0.25418360202178336, 0.13699519461584195, 43.0922202692084], 24: [0.17154911979000545, 0.09779206573939554, 33.70866608680418], 32: [0.13238345313612693, 0.06717102804374953, 27.73032239840148], 40: [0.10155282091077773, 0.08827604860483891, 25.80740959218472], 48: [0.0804603874780619, 0.11134479049495799, 24.990321226804063], 56: [0.07520093748572637, 0.07838021259787221, 23.539295886065354], 64: [0.06840625489476351, 0.0644554662676673, 22.240048452593406], 72: [0.06073128489699746, 0.06656850378448406, 22.33367891824696], 80: [0.057921158400706635, 0.04598359294123291, 22.64801466945193], 88: [0.051760654464714, 0.06261554743345896, 21.899649477242527], 96: [0.048517606433740874, 0.06399115499974133, 21.99996918091404], 104: [0.04464891078713053, 0.07013765230266732, 21.648395948412944], 108: [0.03960497981079123, 0.07462167671107157, 21.631095377735562]}
A100_DECODE_PARAMETERS_SEQLEN_GT_128K={8: [0.49351296145611984, 0.1242778512840786, 81.63597817418449], 16: [0.2491560300575283, 0.14373085926242127, 43.467138891943875], 24: [0.17808174120582407, 0.1253391705756989, 31.23476838369333], 32: [0.13011468071181426, 0.03709183559084327, 28.798562958076687], 40: [0.10504394001297049, 0.09124953244069821, 25.13458913882007], 48: [0.08737949086069731, 0.12705314139622603, 23.912219497443505], 56: [0.07783120870374449, 0.06752216300811083, 23.496935146269635], 64: [0.06643304905430152, 0.048897578271272064, 22.66979669643617], 72: [0.06260115003286587, 0.046573936427122466, 22.294245400828785], 80: [0.06522006970986716, 0.07424560199063844, 19.908283579338516], 88: [0.051295778967957055, 0.04661327315862926, 22.446481258702917], 96: [0.051382462671430214, 0.08366855856565654, 20.799514999904783], 104: [0.046227412125456516, 0.007350328723015922, 23.498654358949256], 108: [0.04046622284662428, 0.06438160300696923, 21.90816436845788]}

A100_8B_PREFILL_PARAMETERS_SEQLEN_LT_2K={8: [6.036595020552074, 4.6024045067682735, 102.41800193337373, 28.62265691235237], 16: [0.8697577207413882, 2.3918598577360637, 59.32088499009329, 15.640546996794725], 24: [4.552142672616793, 1.625418907423418, 31.643309404614712, 15.272578107776688], 32: [-1.7388524446574638, 1.2437383117893166, 37.655166734791486, 7.37600110063476], 40: [1.755774436305516, 1.0396322839105787, 24.156489433031936, 12.415270277516605], 48: [2.358631928422959, 0.8719120540561955, 18.96722422399372, 12.16292965471435], 56: [1.1456100840728345, 0.8133340154842235, 18.835392988773695, 10.471737859260813], 64: [0.5932500198028672, 0.7012581265468132, 19.248143610912237, 9.438733467415052], 72: [1.9624243412953455, 0.6534927596553493, 14.849408809977762, 10.979040671343707], 80: [-0.8875597090947371, 0.6455217991721254, 20.189306432864672, 8.778057495752815], 88: [0.6088746890330615, 0.6169313780033652, 14.66626976830605, 10.388805142682436], 96: [1.9617408747019105, 0.4495429381844609, 11.031653741349817, 11.425749668434356], 104: [2.3104848638018427, 0.4412558521489083, 9.978756947827733, 11.90194896797627], 108: [1.436900482503129, 0.43367056311375274, 12.684469102822826, 9.787081752843424]}
A100_8B_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K={8: [5.282507383021351, 4.461529734630872, 72.83458310108661, 133.76241615088134], 16: [2.478685216288671, 2.246783264138145, 40.04589317327567, 71.87807283409484], 24: [1.9328774419461818, 1.5525785501729352, 24.30858712957717, 52.85493892241544], 32: [1.405080488978121, 1.1419424264279083, 19.994388736397685, 40.76061925696371], 40: [1.073772653662777, 1.002188341155724, 17.65770612099922, 37.0876161896403], 48: [1.0427093535811451, 0.8320263132122951, 13.865424626079111, 34.95844298071992], 56: [0.14171118612464825, 0.7546137660372949, 21.738632607506997, 10.695791973340818], 64: [0.3064813276431474, 0.591736483303841, 17.062057455601643, 18.686218926654988], 72: [0.33474301972381065, 0.5865552626098411, 15.782533138026558, 18.312021695589053], 80: [0.10739476037784203, 0.5843572373347286, 16.973214221199594, 12.356903864510684], 88: [-0.46518869835328003, 0.519871302298708, 21.839642539610306, 0.37704936823055846], 96: [0.44748110687313486, 0.4511476399626857, 11.155688965130418, 21.763572750778465], 104: [0.2798013501430924, 0.44849451933393203, 12.30376890876993, 19.29284632705175], 108: [0.15018315770518204, 0.4491267558185843, 13.804415674688162, 15.026708583735896]}
A100_8B_PREFILL_PARAMETERS_SEQLEN_GT_8K={8: [4.610140474581982, 4.635574151933362, 0.09604459322045773, 1177.2525074039527], 16: [2.3561292204045463, 2.323154847240183, 0.04908602542509471, 624.7990385835362], 24: [1.578781403958039, 1.5622064251639503, 0.03289127924912573, 428.1837182282693], 32: [1.2170433185690308, 1.1658241334867228, 0.025355069136854702, 338.21549229653317], 40: [0.9964645581817106, 0.9443112290164875, 0.02075967829545227, 288.280557276432], 48: [0.8506031859268819, 0.8017987630493953, 0.01772089970680999, 255.5889326845845], 56: [0.746400417996283, 0.6998121966881997, 0.01555000870825586, 235.34162263251505], 64: [0.676512866446707, 0.5893703797663187, 0.014094018050973023, 211.76290154995388], 72: [0.6093506277565439, 0.5549602297411148, 0.012694804744927983, 206.78715920584506], 80: [0.5622027569679845, 0.4855494926320565, 0.011712557436832997, 196.77824436408622], 88: [0.5270755053620457, 0.44484227151668, 0.010980739695042608, 186.03091137242228], 96: [0.4957557910691042, 0.413533455797775, 0.010328245647272988, 176.99043068620495], 104: [0.47686935968801974, 0.3743294756075718, 0.00993477832683373, 169.7151427655822], 108: [0.4711602844537286, 0.37459992519767704, 0.009815839259452666, 164.42607397669417]}
A100_8B_DECODE_PARAMETERS_SEQLEN_LT_128K={8: [0.12222715395642521, 0.06288737207267019, 13.355001107630713], 16: [0.06109755655543484, 0.030881847175231715, 8.953302699880144], 24: [0.04038749138828831, 0.026681809852148245, 7.474763821737739], 32: [0.030267336760071404, 0.02116775321537438, 6.453866907558417], 40: [0.023015362640699887, 0.02585435204919678, 6.272207322828588], 48: [0.019975536964526423, 0.022588373382774685, 6.24846154972644], 56: [0.01681524258004527, 0.02149610376128593, 5.950568065103965], 64: [0.014631981981334564, 0.02192372186386845, 5.562371305220056], 72: [0.01368292549496468, 0.024261844540974287, 5.499412015057753], 80: [0.012599450788648665, 0.019847411183805026, 5.550303596833946], 88: [0.011987623779602155, 0.021919091136523385, 5.494525643341353], 96: [0.011432595669331445, 0.019288138311881666, 5.428015426031489], 104: [0.010183963136469227, 0.019900220523514513, 5.468312842327084], 108: [0.009824402607245881, 0.02270657982915657, 5.4286329880394435]}
A100_8B_DECODE_PARAMETERS_SEQLEN_GT_128K={8: [0.11068504910434544, 0.05979958631873973, 14.799538737213481], 16: [0.05857740988186188, 0.026823594396614518, 9.863000657563013], 24: [0.04385619354240024, 0.08787186233199366, 4.487556718538496], 32: [0.029077255400641315, 0.01411498122689616, 7.049119715862137], 40: [0.023783870716393533, 0.025132030328961958, 6.279098718844727], 48: [0.020119926095601374, 0.02267105745572493, 6.343553535512937], 56: [0.01745760543312492, 0.014014922398450393, 6.16156603422896], 64: [0.02088763443207613, 0.06558547260935549, 3.2996764026957255], 72: [0.018705417498711227, 0.0355623196581829, 4.475861302648518], 80: [0.012721570772503344, 0.014115339778353995, 5.794443121866775], 88: [0.011852088258606897, 0.029678538070229906, 5.552385207405891], 96: [0.0114480767508895, 0.02618842159417015, 5.198487884929503], 104: [0.010709746198451999, -0.005954179262982844, 6.560096374061445], 108: [0.010801624204969378, 0.022731819819418412, 5.371306565468835]}

def predict_prefill_latency_A100(
    sm_count:int,
    token_num:int,
    prefix_num:int
):
    if token_num <= 2048:
        param_map = A100_PREFILL_PARAMETERS_SEQLEN_LT_2K
    elif token_num <= 8192:
        param_map = A100_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K
    else:
        param_map = A100_PREFILL_PARAMETERS_SEQLEN_GT_8K
    a,b,c,d = param_map[sm_count]
    return a * ((token_num / 1024.0) ** 2) + b * token_num / 1024.0 * prefix_num / 1024.0 + c * token_num / 1024.0 + d

def predict_decode_latency_A100(
    sm_count:int,
    batch_size:int,
    prefix:int,    
):
    sm_count = sm_count // 8 * 8
    if prefix <= 128 * 1024:
        param_map = A100_DECODE_PARAMETERS_SEQLEN_LT_128K
    else:
        param_map = A100_DECODE_PARAMETERS_SEQLEN_GT_128K
    a,b,c = param_map[sm_count]
    return a * (prefix / 1024.0) + b * batch_size + c

def predict_prefill_latency_A100_8B(
    sm_count:int,
    token_num:int,
    prefix_num:int
):
    if token_num <= 2048:
        param_map = A100_8B_PREFILL_PARAMETERS_SEQLEN_LT_2K
    elif token_num <= 8192:
        param_map = A100_8B_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K
    else:
        param_map = A100_8B_PREFILL_PARAMETERS_SEQLEN_GT_8K
    a,b,c,d = param_map[sm_count]
    return a * ((token_num / 1024.0) ** 2) + b * token_num / 1024.0 * prefix_num / 1024.0 + c * token_num / 1024.0 + d

def predict_decode_latency_A100_8B(
    sm_count:int,
    batch_size:int,
    prefix:int,    
):
    sm_count = sm_count // 8 * 8
    if prefix <= 128 * 1024:
        param_map = A100_8B_DECODE_PARAMETERS_SEQLEN_LT_128K
    else:
        param_map = A100_8B_DECODE_PARAMETERS_SEQLEN_GT_128K
    a,b,c = param_map[sm_count]
    return a * (prefix / 1024.0) + b * batch_size + c

def predict_prefill_latency_H800(
    sm_count:int,
    token_num:int,
    prefix_num:int
):
    sm_count = sm_count // 8 * 8
    if token_num <= 2048:
        param_map = H800_PREFILL_PARAMETERS_SEQLEN_LT_2K
    elif token_num <= 8192:
        param_map = H800_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K
    else:
        param_map = H800_PREFILL_PARAMETERS_SEQLEN_GT_8K
    a,b,c,d = param_map[sm_count]
    return a * ((token_num / 1024.0) ** 2) + b * token_num / 1024.0 * prefix_num / 1024.0 + c * token_num / 1024.0 + d

def predict_decode_latency_H800(
    sm_count:int,
    batch_size:int,
    prefix:int,
):
    sm_count = sm_count // 8 * 8
    if prefix <= 128 * 1024:
        param_map = H800_DECODE_PARAMETERS_SEQLEN_LT_128K
    else:
        param_map = H800_DECODE_PARAMETERS_SEQLEN_GT_128K
    a,b,c = param_map[sm_count]
    return a * ((prefix / 1024.0) ** 2) + b * batch_size + c

def predict_prefill_latency_3090(
    sm_count:int,
    token_num:int,
    prefix_num:int    
):
    sm_count = sm_count // 8 * 8
    if token_num <= 2048:
        param_map = RTX3090_PREFILL_PARAMETERS_SEQLEN_LT_2K
    elif token_num <= 8192:
        param_map = RTX3090_PREFILL_PARAMETERS_SEQLEN_BT_2K_8K
    else:
        param_map = RTX3090_PREFILL_PARAMETERS_SEQLEN_GT_8K
    a,b,c,d = param_map[sm_count]
    return a * ((token_num / 1024.0) ** 2) + b * token_num / 1024.0 * prefix_num / 1024.0 + c * token_num / 1024.0 + d


def predict_decode_latency_3090(
    sm_count:int,
    batch_size:int,
    prefix:int,
):
    sm_count = sm_count // 8 * 8
    if prefix <= 64 * 1024:
        param_map = RTX3090_DECODE_PARAMETERS_SEQLEN_LT_64K
    else:
        param_map = RTX3090_DECODE_PARAMETERS_SEQLEN_GT_64K
    a,b,c = param_map[sm_count]
    return a * (prefix / 1024.0) + b * batch_size + c




class Predictor:
    def __init__(self, model: str):
        self.model = model
        self.device = torch.cuda.get_device_name(0)
    def predict_prefill_latency(
        self,
        sm_count:int,
        token_num:int,
        prefix_num:int
    ):
        if token_num < 512:
            token_num = 512
        if 'H800' in self.device:
            return predict_prefill_latency_H800(sm_count, token_num, prefix_num)
        elif '3090' in self.device:
            return predict_prefill_latency_3090(sm_count, token_num, prefix_num)
        elif 'A100' in self.device:
            if '8B' in self.model:
                return predict_prefill_latency_A100_8B(sm_count, token_num, prefix_num)
            return predict_prefill_latency_A100(sm_count, token_num, prefix_num)
        else:
            raise NotImplementedError()

    def predict_decode_latency(
        self,
        sm_count:int,
        batch_size:int,
        prefix:int,
    ):
        if 'H800' in self.device:
            return predict_decode_latency_H800(sm_count, batch_size, prefix)
        elif '3090' in self.device:
            return predict_decode_latency_3090(sm_count, batch_size, prefix)
        elif 'A100' in self.device:
            if '8B' in self.model:
                return predict_decode_latency_A100_8B(sm_count, batch_size, prefix)
            return predict_decode_latency_A100(sm_count, batch_size, prefix)
        else:
            raise NotImplementedError()
    def get_prefill_slo(
        self,
        seqlen:int
    ):
        if seqlen < 1024:
            return 1000
        return seqlen

    def get_decode_slo(self):
        if '8B' in self.model:
            return 20
        return 48
