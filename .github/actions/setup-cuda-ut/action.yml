# .github/actions/setup-cuda-ut/action.yml
name: Setup SGLang CI
description: Checkout, download kernel wheel artifacts, and install dependencies
inputs:
  download_kernel_artifacts:
    description: "Whether to download sgl-kernel wheel artifacts"
    required: false
    default: "false"
  artifact_pattern:
    description: "Pattern for artifact name"
    required: false
    default: "wheel-python3.10-cuda12.9"
  extra_install_args:
    description: "Extra args to ci_install_dependency.sh"
    required: false
    default: ""
  is_blackwell:
    description: "Whether to set IS_BLACKWELL=1"
    required: false
    default: "false"
  is_grace_blackwell:
    description: "Whether to set GRACE_BLACKWELL=1"
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - name: Download artifacts
      if: ${{ inputs.download_kernel_artifacts == 'true' }}
      uses: actions/download-artifact@v4
      with:
        path: sgl-kernel/dist/
        merge-multiple: true
        pattern: ${{ inputs.artifact_pattern }}

    - name: Install dependencies
      shell: bash
      env:
        CUSTOM_BUILD_SGL_KERNEL: ${{ inputs.download_kernel_artifacts }}
        IS_BLACKWELL: ${{ inputs.is_blackwell }}
        GRACE_BLACKWELL: ${{ inputs.is_grace_blackwell }}
      run: |
        bash scripts/ci/ci_install_dependency.sh ${{ inputs.extra_install_args }}
